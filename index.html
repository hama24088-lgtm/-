<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµœç”°é«˜æ ¡ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kaisei+Tokumin:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f0f4f8;
            color: #1e3a5f;
        }
        h2, h3 {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .text-shadow-hero {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .bg-hamada-hero {
            background: linear-gradient(to bottom right, #e0f2fe, #3b82f6);
            height: 50vh;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 1rem 2.5rem;
            border-radius: 9999px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 6px 8px rgba(0, 0, 0, 0.15);
        }
        .card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .btn-secondary {
            background-color: #e2e8f0;
            color: #1e3a5f;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #cbd5e1;
        }
        .speaker-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #3b82f6;
            font-size: 2rem;
            line-height: 1;
        }
        #loadingIndicator, #messageLoading {
            display: none;
            color: #3b82f6;
            font-size: 1.2rem;
            margin-top: 1rem;
        }
        .font-shuji {
            font-family: 'Kaisei Tokumin', serif;
        }
    </style>
</head>
<body class="antialiased leading-relaxed">

    <!-- Hero Section -->
    <div class="bg-hamada-hero flex flex-col items-center justify-center text-center p-8">
        <h1 class="text-5xl md:text-6xl font-extrabold text-white text-shadow-hero font-shuji">
            æµœç”°é«˜æ ¡ ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ«
        </h1>
        <p class="mt-4 text-xl md:text-2xl font-bold text-white text-shadow-hero">
            é«˜æ ¡ç”Ÿæ´»ã‚’ä½“é¨“ã—ã‚ˆã†ï¼æ–°ã—ã„è‡ªåˆ†ã«å‡ºä¼šãˆã‚‹ãƒãƒ£ãƒ³ã‚¹
        </p>
        <a href="#event-details" class="mt-8 btn-primary">ä»Šã™ãç”³ã—è¾¼ã‚€</a>
    </div>

    <!-- Main Content Section -->
    <main class="container py-16 px-4">
        <!-- Message Section -->
        <section class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">
                æµœç”°é«˜æ ¡ã¸ã‚ˆã†ã“ãï¼
                <!-- Gemini API (TTS)ã§éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹ãƒœã‚¿ãƒ³ -->
                <button id="speakBtn" class="speaker-btn">âœ¨</button>
            </h2>
            <p id="welcomeText" class="text-lg md:text-xl text-gray-700 max-w-3xl mx-auto">
                æµœç”°é«˜æ ¡ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ«ã§ã¯ã€æˆæ¥­ã®é¢ç™½ã•ã‚„éƒ¨æ´»å‹•ã®æ´»æ°—ã€å…ˆè¼©ãŸã¡ã®ãƒªã‚¢ãƒ«ãªå£°ã‚’é€šã—ã¦ã€é«˜æ ¡ç”Ÿæ´»ã®é­…åŠ›ã‚’ãŸã£ã·ã‚ŠãŠä¼ãˆã—ã¾ã™ã€‚å‹é”ã¨ä¸€ç·’ã«ã€ã¾ãŸã¯ä¸€äººã§ã‚‚å¤§ä¸ˆå¤«ï¼æ°—è»½ã«å‚åŠ ã—ã¦ã€æµœç”°é«˜æ ¡ã®é›°å›²æ°—ã‚’æ„Ÿã˜ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
            </p>
            <div id="loadingIndicator">éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ä¸­ã§ã™...</div>
        </section>

        <!-- Features Section -->
        <section class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
            <div class="card p-6 text-center">
                <div class="text-5xl text-blue-500 mb-4">ğŸ«</div>
                <h3 class="text-xl font-bold mb-2">æˆæ¥­ä½“é¨“</h3>
                <p class="text-gray-600">
                    é«˜æ ¡ã®æˆæ¥­ã‚’å®Ÿéš›ã«ä½“é¨“ï¼èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡ã®æˆæ¥­ã«å‚åŠ ã—ã¦ã€ä¸€è¶³å…ˆã«å­¦ã³ã®æ¥½ã—ã•ã‚’æ„Ÿã˜ã¦ã¿ã‚ˆã†ã€‚
                </p>
            </div>
            <div class="card p-6 text-center">
                <div class="text-5xl text-green-500 mb-4">âš½</div>
                <h3 class="text-xl font-bold mb-2">éƒ¨æ´»å‹•è¦‹å­¦</h3>
                <p class="text-gray-600">
                    æ´»æ°—ã‚ãµã‚Œã‚‹éƒ¨æ´»å‹•ã‚’è¦‹å­¦ï¼å…ˆè¼©ãŸã¡ã®çœŸå‰£ãªå§¿ã‚„ã€ä»²é–“ã®ç¬‘é¡”ã«è§¦ã‚Œã¦ã€é«˜æ ¡ã§ã‚„ã‚ŠãŸã„ã“ã¨ã‚’è¦‹ã¤ã‘ã‚ˆã†ã€‚
                </p>
            </div>
            <div class="card p-6 text-center">
                <div class="text-5xl text-yellow-500 mb-4">ğŸ¤</div>
                <h3 class="text-xl font-bold mb-2">åœ¨æ ¡ç”Ÿã¨äº¤æµ</h3>
                <p class="text-gray-600">
                    åœ¨æ ¡ç”Ÿã¨ç›´æ¥è©±ã›ã‚‹ãƒ•ãƒªãƒ¼ãƒˆãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚’ç”¨æ„ã€‚å­¦æ ¡ç”Ÿæ´»ã®ã“ã¨ã€å‹‰å¼·ã®ã“ã¨ã€ãªã‚“ã§ã‚‚æ°—è»½ã«èã„ã¦ã¿ã‚ˆã†ï¼
                </p>
            </div>
        </section>

        <!-- New: Gemini API (Text Generation) feature -->
        <section class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">
                âœ¨å…ˆè¼©ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            </h2>
            <div class="card p-6 max-w-lg mx-auto">
                <p id="seniorMessage" class="text-lg text-gray-700 mb-4">
                    ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€AIãŒå…ˆè¼©ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
                </p>
                <div id="messageLoading">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆä¸­ã§ã™...</div>
                <button id="generateMessageBtn" class="btn-secondary">âœ¨ AIã«èã„ã¦ã¿ã‚‹</button>
            </div>
        </section>

        <!-- Event Details Section -->
        <section id="event-details" class="text-center mb-16">
            <h2 class="text-3xl md:text-4xl font-bold mb-8">
                ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°
            </h2>
            <div class="card p-8 inline-block text-left">
                <div class="mb-4">
                    <p class="text-xl font-bold mb-2">æ—¥ç¨‹</p>
                    <p class="text-gray-700">2025å¹´10æœˆ26æ—¥(åœŸ) 9:30 - 12:00</p>
                </div>
                <div class="mb-4">
                    <p class="text-xl font-bold mb-2">å ´æ‰€</p>
                    <p class="text-gray-700">æµœç”°é«˜æ ¡ æ ¡èˆ</p>
                </div>
                <div class="mb-4">
                    <p class="text-xl font-bold mb-2">æŒã¡ç‰©</p>
                    <p class="text-gray-700">ä¸Šå±¥ãã€ç­†è¨˜ç”¨å…·</p>
                </div>
                <div>
                    <p class="text-xl font-bold mb-2">å‚åŠ å¯¾è±¡</p>
                    <p class="text-gray-700">ä¸­å­¦3å¹´ç”Ÿ</p>
                </div>
                <a href="#" class="mt-8 block w-full text-center btn-primary">å‚åŠ ç™»éŒ²ã¯ã“ã¡ã‚‰</a>
            </div>
        </section>

        <!-- Gallery Section -->
        <section class="mb-16">
            <h2 class="text-center text-3xl md:text-4xl font-bold mb-8">
                æµœç”°é«˜æ ¡ã®æ—¥å¸¸
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="rounded-2xl overflow-hidden shadow-lg transform transition-transform duration-300 hover:scale-105">
                    <img src="https://placehold.co/400x300/c9d7df/1e3a5f?text=éƒ¨æ´»å‹•ã®æ§˜å­" alt="éƒ¨æ´»å‹•ã®æ§˜å­" class="w-full h-auto object-cover">
                </div>
                <div class="rounded-2xl overflow-hidden shadow-lg transform transition-transform duration-300 hover:scale-105">
                    <img src="https://placehold.co/400x300/e0e9f1/1e3a5f?text=æˆæ¥­é¢¨æ™¯" alt="æˆæ¥­é¢¨æ™¯" class="w-full h-auto object-cover">
                </div>
                <div class="rounded-2xl overflow-hidden shadow-lg transform transition-transform duration-300 hover:scale-105">
                    <img src="https://placehold.co/400x300/f0e6d6/1e3a5f?text=æ–‡åŒ–ç¥­" alt="æ–‡åŒ–ç¥­" class="w-full h-auto object-cover">
                </div>
                <div class="rounded-2xl overflow-hidden shadow-lg transform transition-transform duration-300 hover:scale-105">
                    <img src="https://placehold.co/400x300/d5e3f1/1e3a5f?text=ç”Ÿå¾’ãŸã¡" alt="ç”Ÿå¾’ãŸã¡" class="w-full h-auto object-cover">
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-blue-900 text-white py-8 text-center">
        <div class="container">
            <p>&copy; 2025 æµœç”°é«˜æ ¡ All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’WAVå½¢å¼ã«å¤‰æ›ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function pcmToWav(pcmData, sampleRate) {
            const numChannels = 1;
            const bytesPerSample = 2; // SINT16
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;

            const buffer = new ArrayBuffer(44 + pcmData.byteLength);
            const view = new DataView(buffer);

            // WAV RIFF header
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcmData.byteLength, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bytesPerSample * 8, true);
            writeString(view, 36, 'data');
            view.setUint32(40, pcmData.byteLength, true);

            // Write PCM data
            const pcmView = new Int16Array(pcmData);
            for (let i = 0; i < pcmView.length; i++) {
                view.setInt16(44 + i * 2, pcmView[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        // Base64ã‹ã‚‰ArrayBufferã¸å¤‰æ›
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        const speakBtn = document.getElementById('speakBtn');
        const welcomeTextElement = document.getElementById('welcomeText');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // éŸ³å£°å†ç”Ÿæ©Ÿèƒ½
        speakBtn.addEventListener('click', async () => {
            const textToSpeak = welcomeTextElement.textContent.trim();
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

            loadingIndicator.style.display = 'block';

            const payload = {
                contents: [{
                    parts: [{ text: `Say in a friendly tone: ${textToSpeak}` }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Puck" }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            let audioUrl = null;
            let retries = 0;
            const maxRetries = 3;
            const retryDelay = 1000;

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        if (response.status === 429) {
                            retries++;
                            if (retries < maxRetries) {
                                await new Promise(res => setTimeout(res, retryDelay * Math.pow(2, retries)));
                                continue;
                            }
                        }
                        throw new Error(`API response was not ok: ${response.status}`);
                    }

                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        audioUrl = URL.createObjectURL(wavBlob);
                        break;
                    } else {
                        throw new Error("Invalid audio data from API.");
                    }
                } catch (error) {
                    console.error('Error fetching audio:', error);
                    break;
                }
            }

            loadingIndicator.style.display = 'none';
            if (audioUrl) {
                const audio = new Audio(audioUrl);
                audio.play();
                audio.onended = () => URL.revokeObjectURL(audioUrl);
            }
        });

        const generateMessageBtn = document.getElementById('generateMessageBtn');
        const seniorMessageElement = document.getElementById('seniorMessage');
        const messageLoading = document.getElementById('messageLoading');

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆæ©Ÿèƒ½
        generateMessageBtn.addEventListener('click', async () => {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            messageLoading.style.display = 'block';
            seniorMessageElement.textContent = ''; // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢

            const systemPrompt = `ã‚ãªãŸã¯æµœç”°é«˜æ ¡ã®åœ¨æ ¡ç”Ÿã§ã™ã€‚ä¸­å­¦ç”Ÿã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ«å‚åŠ è€…ã«å‘ã‘ã¦ã€é«˜æ ¡ç”Ÿæ´»ã®æ¥½ã—ã•ã‚„é­…åŠ›ã‚’ä¼ãˆã‚‹åŠ±ã¾ã—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’100æ–‡å­—ä»¥å†…ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚æ•¬ä½“ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚`;
            const userQuery = `ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ«å‚åŠ è€…ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let generatedText = "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
            let retries = 0;
            const maxRetries = 3;
            const retryDelay = 1000;

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                         if (response.status === 429) {
                            retries++;
                            if (retries < maxRetries) {
                                await new Promise(res => setTimeout(res, retryDelay * Math.pow(2, retries)));
                                continue;
                            }
                        }
                        throw new Error(`API response was not ok: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) {
                        generatedText = text;
                        break;
                    } else {
                        throw new Error("Invalid response from API.");
                    }
                } catch (error) {
                    console.error('Error generating message:', error);
                    break;
                }
            }

            messageLoading.style.display = 'none';
            seniorMessageElement.textContent = generatedText;
        });
    </script>
</body>
</html>

